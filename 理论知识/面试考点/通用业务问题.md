# 通用业务问题

## CDN节点？如果某地用户反馈网站打开很慢，怎么解决？

因为对用户来说，获取的资源一般只有两种：

- 静态资源：部署CDN节点。
- 接口数据：拦截所有请求与响应，上报，那么就能查看日志。

## HTTP内容劫持？为什么运营商能加入广告？运营商能进行中间人攻击吗？怎么解决？

公司与运营商对接，一个电话打过去。

## DNS劫持？

解决方案：

- 使用杀毒软件
- HTTP-DNS

## Docker有什么用？为什么要用Docker部署？

## 微信支付

### 详细流程？

参与者：

- 前端
- 后端（应用服务器）
- 微信支付端

“第三方支付”的交互流程：

- 下单（生成预订单）：前端向后端发请求生成订单；后端向微信端发请求（统一下单接口）生成预订单，微信端返回预订单号（prepay_id）；后端将预订单与业务订单关联起来，生成支付参数并签名（paySign），与预订单号一起返回给前端。
- 调起支付（支付预订单）：前端携带支付相关参数向微信端发请求支付，微信端校验参数合法性后返回结果；前端得知参数合法后，要求用户输入密码（请求授权），向微信端请求提交授权信息，微信端验证授权后扣钱；前端自动跳到金额页面、并回调success函数（success只是说明钱扣了，并不代表已经支付成功）。
- 通知支付结果：微信端对后端发请求告知支付结果（成功/失败），后端修改订单状态、发送模板消息（可选）。
- 前端获取支付结果的几种方式
  - 等待：在success回调中向后端轮询结果，成功后再跳转（状态：已成功）。
  - 不等待：先跳转（状态：已支付），等到用户查询订单状态时再请求后端获取订单最新结果。

“非第三方支付”的交互流程（比如“转账”、“发红包”）：

- 下单

参考：[JSAPI支付：业务流程](https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=7_4)

### PC端、H5端、微信网页端这几种前端，在支付流程上有什么细微的区别？

当用户选择了微信支付，并点击“下单”按钮：

- PC端
  - 前端向后端请求生成订单；后端向微信端请求生成预订单；
- H5端：
- 微信网页端（基于JS-SDK）：

### 预订单是什么？为什么会有这个概念？

“预订单”只会出现在“第三方支付”场景中。后端生成订单，微信支付端生成预订单，这两个订单需要关联在一起。

### 前端怎么知道支付的结果？

由于微信端只会将支付结果发送给后端，所以前端不知道支付成功/失败的时间点。于是有几种方案：

- 轮询：前端停留在订单页面，轮询后端，直到结果出来后再跳转。
- 请用户确认：弹窗询问用户是否已完成，如果用户点击“已完成”，前端就可以向后端发起一次请求查询订单状态。如果支付成功，则跳转；如果还没结果，则提示用户稍后再查询且不要重复发起支付。
- 后端推送：通过模板消息，后端可以将结果通过微信客户端来告知客户。
- 用户查询：用户手动查询订单信息，前端请求。

参考：[JSAPI支付：支付回调和查单实现指引](https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=23_9&index=1)
